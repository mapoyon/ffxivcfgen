<html>
<head>
  <meta charset="UTF-8" />
  <title>FFXIV Contents Finder Generator</title>
  <link href="https://fonts.googleapis.com/earlyaccess/sawarabimincho.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.0/build/pure-min.css">
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.4.2/vue.js"></script>
  <style type="text/css">
    body {
      background-color: black;
      background-color: white;
    }
    #svg-template__title,
    #svg-template__notice {
      display: none;
    }
  </style>
</head>
<body>
  <div id="vue-root">
    <input type="text" v-model="content" />
    <input type="file" v-on:change="onChangeImage" />
    <div style="position: relative; display:none;" id="cf-title">
      <div is="cf-title" v-bind:text="'コンテンツ開放'"></div>
    </div>
    <div style="position: relative; display:none;" id="cf-content">
      <div is="cf-title" v-bind:text="content"></div>
    </div>
    <div style="position: relative; display:none;" id="cf-notice">
      <div is="cf-notice"></div>
    </div>
    <canvas id="preview" width="1280" height="720">
    </canvas>
  </div>

  <div id="svg-template__title">
    <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="84px">
      <foreignObject width="100%" height="100%">
        <div xmlns="http://www.w3.org/1999/xhtml" style="
          font-size: 64px;
          font-weight: 900;
          font-family: 'ヒラギノ明朝 ProN', 'Hiragino Mincho ProN', serif;">
          <p style="
            color: #f9960c;
            color: #fdf9e6;
            width: 100%;
            height: 84px;
            line-height: 84px;
            text-align: center;
            margin: 0;
            padding: 0;
            filter: drop-shadow(0px 0px 1px #cb8402) drop-shadow(-1px -1px 1px #cb8402) drop-shadow(1px 1px 1px #cb8402);
            text-shadow: 0px 0px 4px #ffffff, 0px 0px 2px #cb8402, 0px 0px 8px #cb8402;">
            {{ text }}
          </p>
        </div>
      </foreignObject>
    </svg>
  </div>

  <div id="svg-template__notice">
    <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="52px">
      <foreignObject width="100%" height="100%">
        <div xmlns="http://www.w3.org/1999/xhtml" style="
          font-size: 24px;
          font-weight: 300;
          font-family: 'ヒラギノ角ゴ Pro W3', 'HiraKakuPro-W3', sans-serif;
          text-align: center;">
          <div style="
            background-color: rgba(16, 16, 16, 0.5);
            filter: drop-shadow(0px 0px 4px rgba(32, 32, 32, 0.5)) drop-shadow(-1px -1px 4px rgba(32, 32, 32, 0.5)) drop-shadow(1px 1px 4px rgba(32, 32, 32, 0.5));
            border-radius: 20px;
            display: inline-block;
            height: 40px;
            line-height: 40px;
            margin: 4px 32px;
            padding: 0 8px;
            ">
            <p style="
              color: #fdf9e6;
              width: 100%;
              display: block;
              text-align: center;
              margin: 0 8px;
              padding: 0;
              filter: drop-shadow(-1px -1px 1px #cb8402) drop-shadow(1px 1px 1px #cb8402);
              text-shadow: 0px 0px 2px #ffffff, 0px 0px 4px #cb8402;">
              {{ text }}
            </p>
          </div>
        </div>
      </foreignObject>
    </svg>
  </div>

  <script type="text/javascript">
    (function() {
      Vue.component("cf-title", {
        template : "#svg-template__title",
        props: ["text"],
        data: (function() {
          return {
          };
        }),
      });
      Vue.component("cf-notice", {
        template : "#svg-template__notice",
        data: (function() {
          return {
            text: "新しいコンテンツがコンテンツファインダーに登録されました。",
          };
        }),
      });

      var vm = new Vue({
        el: "#vue-root",
        data: {
          content: "邪教排撃 古城アムダプール",
        },
        methods: {
          onChangeImage: (function(e) {
            console.log(e);
            var preview = document.querySelector("#preview");
            var context = preview.getContext("2d");
            var file = e.target.files[0];

            if(! file.type.match(/^image\/(png|jpeg|gif)$/)) {
              return;
            }

            var image = new Image();
            var reader = new FileReader();

            reader.onload = function(e) {
              image.onload = function() {
                (function() {
                  var data = document.querySelector("#cf-title").innerHTML;
                  var DOMURL = self.URL || self.webkitURL || self;
                  var img = new Image();
                  var svg = new Blob([data], {type: "image/svg+xml;charset=utf-8"});
                  var url = DOMURL.createObjectURL(svg);

                  img.onload = function() {
                      context.drawImage(img, 0, 720 * 0.3);
                      DOMURL.revokeObjectURL(url);
                  };
                  img.src = url;
                })();
                (function() {
                  var data = document.querySelector("#cf-content").innerHTML;
                  var DOMURL = self.URL || self.webkitURL || self;
                  var img = new Image();
                  var svg = new Blob([data], {type: "image/svg+xml;charset=utf-8"});
                  var url = DOMURL.createObjectURL(svg);

                  img.onload = function() {
                      context.drawImage(img, 0, 720 * 0.3 + 84);
                      DOMURL.revokeObjectURL(url);
                  };
                  img.src = url;
                })();
                (function() {
                  var data = document.querySelector("#cf-notice").innerHTML;
                  var DOMURL = self.URL || self.webkitURL || self;
                  var img = new Image();
                  var svg = new Blob([data], {type: "image/svg+xml;charset=utf-8"});
                  var url = DOMURL.createObjectURL(svg);

                  img.onload = function() {
                    context.drawImage(img, 0, 720 * 0.8);
                    DOMURL.revokeObjectURL(url);
                  }

                  img.src = url;
                })();

                context.drawImage(image, 0, 0, image.width, image.height, 0, 0, 1280, 720);
              }

              image.src = e.target.result;
            }

            reader.readAsDataURL(file);
          }),
        },
      });
    })();
  </script>
</body>
</html>
